{% extends base_template %}

{% block title %}Evotche - {{ ballot.ballot_name|title }} Results{% endblock title %}

{% block content %}
{% load extras %}


  <div class="container">
    <h1 class="pt-2 my-text-purple">{{ ballot.ballot_name|title }} Results</h1>
    <div class="divider mb-4"></div>
    <div class="row">
      {% if caty_list|length > 0 %}
      <div class="col-12 col-md-10 bg-white mx-auto mt-3 pt-3">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Category</th>
              <th scope="col">Choice</th>
              <th scope="col">Votes</th>
              <th scope="col">Winner</th>
            </tr>
          </thead>
          <tbody>
            <!-- It works, let it be! I repeat, let it be! -->
            <tr>
              {% for caty in caty_list %}
                {% with choices=caty.choice_set.all %}
                  {% max_votes choices as winner %}
                  <th rowspan="{{choices.count}}" scope="row">{{forloop.counter}}</th>
                  <td rowspan="{{choices.count}}">{{ caty|title }}</td>
                  {% for choice in choices %}
                    <td>{{ choice.choice|title }}</td>
                    <td>{{ choice.votes }}</td>
                    {% if winner == choice.votes %}
                      <td class="text-center"><i class="fa my-text-purple">&#xf00c;</i></td>
                    {% else %}
                      <td></td>
                    {% endif %}
            </tr>
                  {% endfor %}
                {% endwith %}
              {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="col-sm-6 col-lg-4 my-4">
        <h4 class="text-center">No Categories Available.</h4>
      </div>
      {% endif %}
    </div>
  </div>


{% endblock content %}